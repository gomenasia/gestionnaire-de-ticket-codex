{% extends 'base.html' %}
{% block content %}
<<<<<<< HEAD
  <section class="filters">
    <form method="get">
      <label for="status">Statut</label>
      <select name="status" id="status">
        <option value="all" {% if current_status == 'all' %}selected{% endif %}>Tous</option>
        <option value="en_attente" {% if current_status == 'en_attente' %}selected{% endif %}>En attente</option>
        <option value="en_cours" {% if current_status == 'en_cours' %}selected{% endif %}>En cours</option>
        <option value="resolu" {% if current_status == 'resolu' %}selected{% endif %}>Résolu</option>
      </select>

      <label for="sort">Tri</label>
      <select name="sort" id="sort">
        <option value="recent" {% if current_sort == 'recent' %}selected{% endif %}>Plus récents</option>
        <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>Plus anciens</option>
      </select>

      <label for="q">Recherche contenu</label>
      <input type="search" id="q" name="q" placeholder="mot clé" value="{{ current_q }}" />

      <label for="author">Auteur</label>
      <input type="search" id="author" name="author" placeholder="nom d'utilisateur" value="{{ current_author }}" />

      <button type="submit">Filtrer</button>
=======
  <section class="filters horizontal">
    <form method="get">
      <div class="filter-item">
        <label for="status">Statut</label>
        <select name="status" id="status">
          <option value="all" {% if current_status == 'all' %}selected{% endif %}>Tous</option>
          <option value="en_attente" {% if current_status == 'en_attente' %}selected{% endif %}>En attente</option>
          <option value="en_cours" {% if current_status == 'en_cours' %}selected{% endif %}>En cours</option>
          <option value="resolu" {% if current_status == 'resolu' %}selected{% endif %}>Résolu</option>
        </select>
      </div>

      <div class="filter-item">
        <label for="sort">Tri</label>
        <select name="sort" id="sort">
          <option value="recent" {% if current_sort == 'recent' %}selected{% endif %}>Plus récents</option>
          <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>Plus anciens</option>
        </select>
      </div>

      <div class="filter-item grow">
        <label for="q">Recherche contenu</label>
        <input type="search" id="q" name="q" placeholder="mot clé" value="{{ current_q }}" />
      </div>

      <div class="filter-item grow">
        <label for="author">Auteur</label>
        <input type="search" id="author" name="author" placeholder="nom d'utilisateur" value="{{ current_author }}" />
      </div>

      <div class="filter-item align-end">
        <button type="submit">Filtrer</button>
      </div>
>>>>>>> 23263c0de9d4f925ff941a244cb4ff6efc0d7eed
    </form>
  </section>

  <section class="ticket-list">
    {% for ticket in tickets %}
      <article class="ticket">
        <div class="ticket-head">
          <h3>{{ ticket.title }}</h3>
          <span class="status {{ ticket.status }}">{{ ticket.status.replace('_', ' ').title() }}</span>
        </div>
        <p>{{ ticket.content }}</p>
        <small>
          Auteur: {{ ticket.author.username }} · Créé le {{ ticket.created_at.strftime('%d/%m/%Y %H:%M') }}
        </small>
<<<<<<< HEAD
=======

        {% if g.user and g.user.id == ticket.author_id %}
          <div class="author-actions">
            <a class="link-button" href="{{ url_for('edit_ticket', ticket_id=ticket.id) }}">Modifier mon ticket</a>
          </div>
        {% endif %}

>>>>>>> 23263c0de9d4f925ff941a244cb4ff6efc0d7eed
        {% if ticket.admin_response %}
          <div class="admin-response">
            <strong>Réponse admin:</strong>
            <p>{{ ticket.admin_response }}</p>
          </div>
        {% endif %}

        {% if g.user and g.user.is_admin %}
          <form method="post" action="{{ url_for('admin_update_ticket', ticket_id=ticket.id) }}" class="admin-form">
            <select name="status">
              <option value="en_attente" {% if ticket.status == 'en_attente' %}selected{% endif %}>En attente</option>
              <option value="en_cours" {% if ticket.status == 'en_cours' %}selected{% endif %}>En cours</option>
              <option value="resolu" {% if ticket.status == 'resolu' %}selected{% endif %}>Résolu</option>
            </select>
            <textarea name="admin_response" rows="2" placeholder="Réponse administrateur">{{ ticket.admin_response or '' }}</textarea>
            <button type="submit">Mettre à jour</button>
          </form>
        {% endif %}
      </article>
    {% else %}
      <p>Aucun ticket ne correspond à vos critères.</p>
    {% endfor %}
  </section>
{% endblock %}
